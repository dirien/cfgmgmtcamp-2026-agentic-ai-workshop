name: 01-k8s-cluster
runtime: yaml
description: DigitalOcean Kubernetes cluster for CfgMgmtCamp 2026 workshop

config:
  nodeCount:
    type: integer
    default: 2
  nodeSize:
    type: string
    default: s-4vcpu-8gb
  region:
    type: string
    default: fra1
  k8sVersion:
    type: string
    default: "1.34"

variables:
  k8sVersions:
    fn::invoke:
      function: digitalocean:getKubernetesVersions
      arguments:
        versionPrefix: ${k8sVersion}

resources:
  workshop-cluster:
    type: digitalocean:KubernetesCluster
    properties:
      name: cfgmgmtcamp-2026-${pulumi.organization}-${pulumi.stack}
      region: ${region}
      version: ${k8sVersions.latestVersion}
      nodePool:
        name: default-pool
        size: ${nodeSize}
        nodeCount: ${nodeCount}
        labels:
          workshop: cfgmgmtcamp-2026
          purpose: agentic-ai
      tags:
        - cfgmgmtcamp
        - workshop
        - "2026"

outputs:
  clusterName: ${workshop-cluster.name}
  clusterEndpoint: ${workshop-cluster.endpoint}
  clusterUrn: ${workshop-cluster.clusterUrn}
  kubeconfig: ${workshop-cluster.kubeConfigs[0].rawConfig}
